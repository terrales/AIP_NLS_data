<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>German Topic Popularity</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        /* Define the font family for better aesthetics */
        :root {
            font-family: 'Inter', sans-serif;
        }

        /* Basic styling for the SVG container */
        #bubble-chart-container {
            width: 100%;
            height: 80vh; /* Use viewport height for a good size */
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* Hide overflow outside the SVG viewbox */
        }

        /* Styling for the bubbles */
        .node circle {
            cursor: pointer;
            transition: fill 0.3s, transform 0.3s;
            stroke: #fff;
            stroke-width: 2px;
        }

        .node circle:hover {
            opacity: 0.85;
            /* Note: We remove the CSS scale on hover here because it might conflict with D3 zoom transform */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-8">

    <div class="max-w-4xl mx-auto">
        <!-- Header Card -->
        <header class="text-center mb-8 p-6 bg-white rounded-xl shadow-lg">
            <h1 class="text-3xl font-extrabold text-indigo-700">German Topic Popularity</h1>
            <p class="mt-2 text-gray-600">
                A D3 Bubble Chart visualizing the relative size/frequency of major library topics.
                Bubble size corresponds to the number of books in that category.
            </p>
            <p class="mt-4 text-sm font-semibold text-green-600">
                Use your mouse wheel to **zoom** and click-and-drag to **pan** the chart!
            </p>
        </header>

        <!-- Bubble Chart Container -->
        <div class="bg-white p-4 sm:p-8 rounded-xl shadow-lg border border-gray-200">
            <div id="bubble-chart-container">
                <!-- D3 SVG will be inserted here -->
            </div>
        </div>

        <!-- Data Legend/Key -->
        <div class="mt-8 p-4 bg-white rounded-xl shadow-md text-sm text-gray-700">
            <h2 class="font-bold text-lg mb-2 text-indigo-600">Data Key</h2>
            <p>The total "size" of the collection represented here is 16,995 units (e.g., books/documents). The topics are:</p>
            <ul class="list-disc list-inside mt-2 grid grid-cols-2 sm:grid-cols-4 gap-x-4">
                <li><span class="font-medium">Reformation: 2163:</span> 2,163</li>
                <li><span class="font-medium">Art and Artists: 1378:</span> 1,378</li>
                <li><span class="font-medium">German Literature: 1126:</span> 1,126</li>
                <li><span class="font-medium">Economics and Management: 1051:</span> 1,051</li>
                <li><span class="font-medium">Music: 955:</span> 955</li>
                <li><span class="font-medium">Drama: 757:</span> 757</li>
                <li><span class="font-medium">Medicine: 548:</span> 548</li>
                <li><span class="font-medium">Libraries and Manuscripts: 529:</span> 529</li>
                <li><span class="font-medium">City maps: 497:</span> 497</li>
                <li><span class="font-medium">Philosophy: 493:</span> 493</li>
                <li><span class="font-medium">Cartography: 447:</span> 447</li>
                <li><span class="font-medium">Alpine Adventures: 369:</span> 369</li>
                <li><span class="font-medium">Poetry and Romanticism: 291:</span> 291</li>
                <li><span class="font-medium">National Socialism: 290:</span> 290</li>
                <li><span class="font-medium">German language: 259:</span> 259</li>
                <li><span class="font-medium">Marketing and Sales: 252:</span> 252</li>
                <li><span class="font-medium">Computer Science: 241:</span> 241</li>
                <li><span class="font-medium">Legal History: 241:</span> 241</li>
                <li><span class="font-medium">Education and Social Inequality: 211:</span> 211</li>
                <li><span class="font-medium">Politics: 202:</span> 202</li>
                <li><span class="font-medium">Mathematics: 180:</span> 180</li>
                <li><span class="font-medium">Architecture: 144:</span> 144</li>
                <li><span class="font-medium">Classical Antiquity: 139:</span> 139</li>
                <li><span class="font-medium">Socialism and Communism: 138:</span> 138</li>
                <li><span class="font-medium">German Cities and History: 138:</span> 138</li>
                <li><span class="font-medium">Polar Exploration: 135:</span> 135</li>
                <li><span class="font-medium">German History: 124:</span> 124</li>
                <li><span class="font-medium">Sociology and Methodology: 118:</span> 118</li>
                <li><span class="font-medium">Jewish history: 113:</span> 113</li>
                <li><span class="font-medium">Baking Industry: 111:</span> 111</li>
                <li><span class="font-medium">Accounting: 110:</span> 110</li>
                <li><span class="font-medium">Baking and Confectionery: 104:</span> 104</li>
                <li><span class="font-medium">World War II: 96:</span> 96</li>
                <li><span class="font-medium">Operations and Supply Chain Management: 95:</span> 95</li>
                <li><span class="font-medium">Indeterminate: 85:</span> 85</li>
                <li><span class="font-medium">German Poetry: 82:</span> 82</li>
                <li><span class="font-medium">Media Studies: 80:</span> 80</li>
                <li><span class="font-medium">German fiction: 80:</span> 80</li>
                <li><span class="font-medium">Medieval Literature: 73:</span> 73</li>
                <li><span class="font-medium">Rainer Maria Rilke: 73:</span> 73</li>
                <li><span class="font-medium">Healthcare Management and Aging: 64:</span> 64</li>
                <li><span class="font-medium">European University Histories: 61:</span> 61</li>
                <li><span class="font-medium">Classical Literature: 61:</span> 61</li>
                <li><span class="font-medium">Psalms: 60:</span> 60</li>
                <li><span class="font-medium">Geology: 60:</span> 60</li>
                <li><span class="font-medium">Switzerland Travel: 59:</span> 59</li>
                <li><span class="font-medium">Libraries: 59:</span> 59</li>
                <li><span class="font-medium">German Exile Literature: 58:</span> 58</li>
                <li><span class="font-medium">Academia and Science: 57:</span> 57</li>
                <li><span class="font-medium">Mental Health: 57:</span> 57</li>
                <li><span class="font-medium">Russian Literature: 55:</span> 55</li>
                <li><span class="font-medium">Astronomy: 55:</span> 55</li>
                <li><span class="font-medium">Travel and Heritage: 54:</span> 54</li>
                <li><span class="font-medium">Friedrich Nietzsche: 52:</span> 52</li>
                <li><span class="font-medium">Engineering Mechanics: 52:</span> 52</li>
                <li><span class="font-medium">Enlightenment: 51:</span> 51</li>
                <li><span class="font-medium">Botany and Horticulture: 50:</span> 50</li>
                <li><span class="font-medium">Social Work: 49:</span> 49</li>
                <li><span class="font-medium">Automotive Technology: 46:</span> 46</li>
                <li><span class="font-medium">Feminism and Gender Studies: 45:</span> 45</li>
                <li><span class="font-medium">Chemistry: 44:</span> 44</li>
                <li><span class="font-medium">Poland and Slavic Studies: 43:</span> 43</li>
                <li><span class="font-medium">European Integration: 43:</span> 43</li>
                <li><span class="font-medium">IT in Business: 41:</span> 41</li>
                <li><span class="font-medium">World War I: 40:</span> 40</li>
                <li><span class="font-medium">Urban Studies: 39:</span> 39</li>
                <li><span class="font-medium">Franz Kafka: 39:</span> 39</li>
                <li><span class="font-medium">Typography: 39:</span> 39</li>
                <li><span class="font-medium">Natural history: 38:</span> 38</li>
                <li><span class="font-medium">Otto von Bismarck: 38:</span> 38</li>
                <li><span class="font-medium">Electrical Engineering: 38:</span> 38</li>
                <li><span class="font-medium">Meteorology: 37:</span> 37</li>
                <li><span class="font-medium">Russian history: 37:</span> 37</li>
                <li><span class="font-medium">Classical Languages: 36:</span> 36</li>
                <li><span class="font-medium">German Newspapers: 36:</span> 36</li>
                <li><span class="font-medium">German Cinema: 35:</span> 35</li>
                <li><span class="font-medium">Archaeology: 35:</span> 35</li>
                <li><span class="font-medium">Satire and Poetry: 35:</span> 35</li>
                <li><span class="font-medium">German Philology: 34:</span> 34</li>
                <li><span class="font-medium">Aesthetics: 34:</span> 34</li>
                <li><span class="font-medium">Friedrich HÃ¶lderlin: 34:</span> 34</li>
                <li><span class="font-medium">Prussian History: 33:</span> 33</li>
                <li><span class="font-medium">Thermodynamics and Fluid Dynamics: 33:</span> 33</li>
                <li><span class="font-medium">Energy Systems: 33:</span> 33</li>
                <li><span class="font-medium">European Royalty: 32:</span> 32</li>
                <li><span class="font-medium">Materials Science: 32:</span> 32</li>
                <li><span class="font-medium">Law and Jurisprudence: 32:</span> 32</li>
                <li><span class="font-medium">Brothers Grimm: 31:</span> 31</li>
                <li><span class="font-medium">Linguistics: 31:</span> 31</li>
                <li><span class="font-medium">Church Architecture: 31:</span> 31</li>
                <li><span class="font-medium">Witchcraft: 31:</span> 31</li>
                <li><span class="font-medium">African Exploration: 30:</span> 30</li>
                <li><span class="font-medium">Medieval Studies: 30:</span> 30</li>
                <li><span class="font-medium">Photography: 29:</span> 29</li>
                <li><span class="font-medium">Unavailable Data: 29:</span> 29</li>
                <li><span class="font-medium">Festschrift Celebrations: 29:</span> 29</li>
                <li><span class="font-medium">Austrian History: 28:</span> 28</li>
                <li><span class="font-medium">Calendars: 28:</span> 28</li>
                <li><span class="font-medium">Statistics: 28:</span> 28</li>
                <li><span class="font-medium">Norse Mythology: 27:</span> 27</li>
            </ul>
        </div>
    </div>

    <script>
        // Global variable to hold the initialized D3 chart group
        let chartGroup; 

        // Use a function to ensure D3 logic runs only after the DOM is fully loaded.
        function createBubbleChart() {
            // --- 1. Dynamic Data (Injected by Python) ---
const data = {
    "name": "Library Collection",
    "children": [
        {
            "name": "Reformation: 2163",
            "size": 2163
        },
        {
            "name": "Art and Artists: 1378",
            "size": 1378
        },
        {
            "name": "German Literature: 1126",
            "size": 1126
        },
        {
            "name": "Economics and Management: 1051",
            "size": 1051
        },
        {
            "name": "Music: 955",
            "size": 955
        },
        {
            "name": "Drama: 757",
            "size": 757
        },
        {
            "name": "Medicine: 548",
            "size": 548
        },
        {
            "name": "Libraries and Manuscripts: 529",
            "size": 529
        },
        {
            "name": "City maps: 497",
            "size": 497
        },
        {
            "name": "Philosophy: 493",
            "size": 493
        },
        {
            "name": "Cartography: 447",
            "size": 447
        },
        {
            "name": "Alpine Adventures: 369",
            "size": 369
        },
        {
            "name": "Poetry and Romanticism: 291",
            "size": 291
        },
        {
            "name": "National Socialism: 290",
            "size": 290
        },
        {
            "name": "German language: 259",
            "size": 259
        },
        {
            "name": "Marketing and Sales: 252",
            "size": 252
        },
        {
            "name": "Computer Science: 241",
            "size": 241
        },
        {
            "name": "Legal History: 241",
            "size": 241
        },
        {
            "name": "Education and Social Inequality: 211",
            "size": 211
        },
        {
            "name": "Politics: 202",
            "size": 202
        },
        {
            "name": "Mathematics: 180",
            "size": 180
        },
        {
            "name": "Architecture: 144",
            "size": 144
        },
        {
            "name": "Classical Antiquity: 139",
            "size": 139
        },
        {
            "name": "Socialism and Communism: 138",
            "size": 138
        },
        {
            "name": "German Cities and History: 138",
            "size": 138
        },
        {
            "name": "Polar Exploration: 135",
            "size": 135
        },
        {
            "name": "German History: 124",
            "size": 124
        },
        {
            "name": "Sociology and Methodology: 118",
            "size": 118
        },
        {
            "name": "Jewish history: 113",
            "size": 113
        },
        {
            "name": "Baking Industry: 111",
            "size": 111
        },
        {
            "name": "Accounting: 110",
            "size": 110
        },
        {
            "name": "Baking and Confectionery: 104",
            "size": 104
        },
        {
            "name": "World War II: 96",
            "size": 96
        },
        {
            "name": "Operations and Supply Chain Management: 95",
            "size": 95
        },
        {
            "name": "Indeterminate: 85",
            "size": 85
        },
        {
            "name": "German Poetry: 82",
            "size": 82
        },
        {
            "name": "Media Studies: 80",
            "size": 80
        },
        {
            "name": "German fiction: 80",
            "size": 80
        },
        {
            "name": "Medieval Literature: 73",
            "size": 73
        },
        {
            "name": "Rainer Maria Rilke: 73",
            "size": 73
        },
        {
            "name": "Healthcare Management and Aging: 64",
            "size": 64
        },
        {
            "name": "European University Histories: 61",
            "size": 61
        },
        {
            "name": "Classical Literature: 61",
            "size": 61
        },
        {
            "name": "Psalms: 60",
            "size": 60
        },
        {
            "name": "Geology: 60",
            "size": 60
        },
        {
            "name": "Switzerland Travel: 59",
            "size": 59
        },
        {
            "name": "Libraries: 59",
            "size": 59
        },
        {
            "name": "German Exile Literature: 58",
            "size": 58
        },
        {
            "name": "Academia and Science: 57",
            "size": 57
        },
        {
            "name": "Mental Health: 57",
            "size": 57
        },
        {
            "name": "Russian Literature: 55",
            "size": 55
        },
        {
            "name": "Astronomy: 55",
            "size": 55
        },
        {
            "name": "Travel and Heritage: 54",
            "size": 54
        },
        {
            "name": "Friedrich Nietzsche: 52",
            "size": 52
        },
        {
            "name": "Engineering Mechanics: 52",
            "size": 52
        },
        {
            "name": "Enlightenment: 51",
            "size": 51
        },
        {
            "name": "Botany and Horticulture: 50",
            "size": 50
        },
        {
            "name": "Social Work: 49",
            "size": 49
        },
        {
            "name": "Automotive Technology: 46",
            "size": 46
        },
        {
            "name": "Feminism and Gender Studies: 45",
            "size": 45
        },
        {
            "name": "Chemistry: 44",
            "size": 44
        },
        {
            "name": "Poland and Slavic Studies: 43",
            "size": 43
        },
        {
            "name": "European Integration: 43",
            "size": 43
        },
        {
            "name": "IT in Business: 41",
            "size": 41
        },
        {
            "name": "World War I: 40",
            "size": 40
        },
        {
            "name": "Urban Studies: 39",
            "size": 39
        },
        {
            "name": "Franz Kafka: 39",
            "size": 39
        },
        {
            "name": "Typography: 39",
            "size": 39
        },
        {
            "name": "Natural history: 38",
            "size": 38
        },
        {
            "name": "Otto von Bismarck: 38",
            "size": 38
        },
        {
            "name": "Electrical Engineering: 38",
            "size": 38
        },
        {
            "name": "Meteorology: 37",
            "size": 37
        },
        {
            "name": "Russian history: 37",
            "size": 37
        },
        {
            "name": "Classical Languages: 36",
            "size": 36
        },
        {
            "name": "German Newspapers: 36",
            "size": 36
        },
        {
            "name": "German Cinema: 35",
            "size": 35
        },
        {
            "name": "Archaeology: 35",
            "size": 35
        },
        {
            "name": "Satire and Poetry: 35",
            "size": 35
        },
        {
            "name": "German Philology: 34",
            "size": 34
        },
        {
            "name": "Aesthetics: 34",
            "size": 34
        },
        {
            "name": "Friedrich H\u00f6lderlin: 34",
            "size": 34
        },
        {
            "name": "Prussian History: 33",
            "size": 33
        },
        {
            "name": "Thermodynamics and Fluid Dynamics: 33",
            "size": 33
        },
        {
            "name": "Energy Systems: 33",
            "size": 33
        },
        {
            "name": "European Royalty: 32",
            "size": 32
        },
        {
            "name": "Materials Science: 32",
            "size": 32
        },
        {
            "name": "Law and Jurisprudence: 32",
            "size": 32
        },
        {
            "name": "Brothers Grimm: 31",
            "size": 31
        },
        {
            "name": "Linguistics: 31",
            "size": 31
        },
        {
            "name": "Church Architecture: 31",
            "size": 31
        },
        {
            "name": "Witchcraft: 31",
            "size": 31
        },
        {
            "name": "African Exploration: 30",
            "size": 30
        },
        {
            "name": "Medieval Studies: 30",
            "size": 30
        },
        {
            "name": "Photography: 29",
            "size": 29
        },
        {
            "name": "Unavailable Data: 29",
            "size": 29
        },
        {
            "name": "Festschrift Celebrations: 29",
            "size": 29
        },
        {
            "name": "Austrian History: 28",
            "size": 28
        },
        {
            "name": "Calendars: 28",
            "size": 28
        },
        {
            "name": "Statistics: 28",
            "size": 28
        },
        {
            "name": "Norse Mythology: 27",
            "size": 27
        }
    ]
};

            // --- 2. Chart Setup and Responsiveness ---
            const container = document.getElementById('bubble-chart-container');
            let width = container.clientWidth;
            let height = container.clientHeight;

            // Initialize or clear the SVG
            d3.select("#bubble-chart-container svg").remove();

            const svg = d3.select("#bubble-chart-container")
                .append("svg")
                .attr("viewBox", `0 0 ${width} ${height}`)
                .attr("preserveAspectRatio", "xMinYMin meet")
                .style("display", "block");

            // NEW: Append a group element that will hold the zoomable chart content
            // All bubbles and text will be appended to this group.
            chartGroup = svg.append("g"); 

            // Define the pack layout function
            const pack = d3.pack()
                .size([width, height])
                .padding(2);

            // --- 3. Data Processing ---
            const root = d3.hierarchy(data)
                .sum(d => d.size) // Use the 'size' property to determine bubble area
                .sort((a, b) => b.value - a.value); // Sort larger bubbles first

            // Apply the layout to the root node to calculate positions (x, y) and radius (r)
            const nodes = pack(root).descendants();

            // --- 4. Color Scale ---
            // Define a color scale to differentiate topics
            const color = d3.scaleOrdinal(d3.schemeCategory10);

            // Define the group (node) elements for the bubbles and text, appending to chartGroup
            const node = chartGroup.selectAll(".node")
                .data(nodes.filter(d => d.depth === 1)) // Filter to only include the main topics (depth 1)
                .enter().append("g")
                .attr("class", "node")
                .attr("transform", d => `translate(${d.x},${d.y})`);

            // --- 5. Draw Bubbles (Circles) ---
            node.append("circle")
                .attr("r", d => d.r) // Use the radius calculated by d3.pack
                .attr("fill", (d, i) => color(i))
                .attr("opacity", 0.9)
                .append("title") // Add tooltips for accessibility
                .text(d => `${d.data.name}: ${d.data.size} units`);

            // --- 6. Draw Labels (Text) ---
            // We use <foreignObject> to embed HTML <divs> which allows for text wrapping.
            const foreignObject = node.append("foreignObject")
                .attr("width", d => d.r * 2) // Set width to bubble diameter
                .attr("height", d => d.r * 2) // Set height to bubble diameter
                .attr("x", d => -d.r) // Center horizontally (offset by radius)
                .attr("y", d => -d.r) // Center vertically (offset by radius)
                .style("pointer-events", "none"); // Text should not interfere with mouse events

            // Add the HTML div for text content
            foreignObject.append("xhtml:div")
                .style("width", "100%")
                .style("height", "100%")
                .style("display", "flex")
                .style("align-items", "center")
                .style("justify-content", "center")
                .style("text-align", "center")
                .style("font-weight", "600")
                .style("color", "white")
                .style("text-shadow", "0 1px 1px rgba(0, 0, 0, 0.3)")
                // Scale font size. We use d.r / 4 to be a bit smaller to allow for wrapping.
                .style("font-size", d => `${Math.min(24, Math.max(8, d.r / 4))}px`)
                // Allow long words to break and wrap
                .style("word-break", "break-word")
                .style("overflow-wrap", "break-word")
                .html(d => d.data.name); // Set the text content

            // --- 7. Zoom Functionality ---

            // Handler function for the zoom event
            function zoomed(event) {
                // Apply the new transform (k, x, y) to the chart group
                chartGroup.attr("transform", event.transform);
            }

            // Create the zoom behavior
            const zoom = d3.zoom()
                .scaleExtent([0.5, 8]) // Allow scaling between 50% and 800%
                .on("zoom", zoomed); // Attach the zoom handler

            // Apply the zoom behavior to the main SVG element
            svg.call(zoom);


            // --- 8. Responsive handling for resizing (container changes) ---
            function handleResize() {
                // Recalculate container dimensions
                width = container.clientWidth;
                height = container.clientHeight;

                // Update SVG viewbox and pack layout size
                svg.attr("viewBox", `0 0 ${width} ${height}`);
                pack.size([width, height]);

                // Recalculate layout and update positions/radii
                const newRoot = pack(root);

                // --- UPDATED LOGIC ---
                // Store the selection of nodes and bind the new data
                const updatedNodes = chartGroup.selectAll(".node")
                    .data(newRoot.descendants().filter(d => d.depth === 1));

                // Update positions of the <g> node group
                updatedNodes.attr("transform", d => `translate(${d.x},${d.y})`);

                // Use the updated selection to update the child <circle>
                updatedNodes.select("circle")
                    .attr("r", d => d.r);

                // Use the updated selection to update the child <foreignObject>
                const updatedForeignObject = updatedNodes.select("foreignObject")
                    .attr("width", d => d.r * 2)
                    .attr("height", d => d.r * 2)
                    .attr("x", d => -d.r)
                    .attr("y", d => -d.r);

                // And update the div inside it
                updatedForeignObject.select("div")
                    .style("font-size", d => `${Math.min(24, Math.max(1, d.r / 6))}px`)
                    .html(d => d.data.name); // Re-apply text in case it was lost
            }

            // Debounce the resize event to prevent performance issues
            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(handleResize, 150);
            });

            // Call resize once on load to ensure initial fit
            handleResize();
        }

        // Run the chart function when the window loads
        window.onload = createBubbleChart;
    </script>
</body>
</html>
